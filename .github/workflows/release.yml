# Copyright 2020 Google LLC
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a echo "Generating ApiDemos (Java) APKs"
cd $GITHUB_WORKSPACE/ApiDemos/java # Or adjust to the correct path
./gradlew assemble
cp ./app/build/outputs/apk/debug/app-debug.apk $GITHUB_WORKSPACE/ApiDemos-java-debug.apk

echo "Generating Kotlin (Kotlin) APKs"
cd $GITHUB_WORKSPACE/ApiDemos/kotlin # Or adjust to the correct path
./gradlew assemble
cp ./app/build/outputs/apk/debug/app-debug.apk $GITHUB_WORKSPACE/ApiDemos-kotlin-debug.apkcopy of the License at
#
#      http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

name: Release
on:
  push:
    branches: [ main ]
  workflow_dispatch:
jobs:
  release:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout
      uses: actions/checkout@v2
      with:
        token: ${{ secrets.SYNCED_GITHUB_TOKEN_REPO }}

    - name: set up Java 21
      uses: actions/setup-java@v3
      with:
        distribution: 'temurin'
 name: CI Release

on:
  push:
    branches:
      - main # Or whatever branch you want to trigger this on

jobs:
  build-apks:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v4

    - name: Set up JDK 21
      uses: actions/setup-java@v4
      with:
        java-version: '21'
        distribution: 'temurin'
        cache: 'gradle'

    - name: List GITHUB_WORKSPACE contents (for debugging)
      run: |
        echo "Current GITHUB_WORKSPACE: ${{ github.workspace }}"
        ls -F ${{ github.workspace }}
        ls -F ${{ github.workspace }}/ApiDemos # Check this path specifically

    - name: Build ApiDemos (Java) APK
      run: |
        echo "Generating ApiDemos (Java) APKs"
        # Adjust the path below if 'ApiDemos' is directly in the root of the checked out repo
        # If your 'ApiDemos' directory is at the root of your repository,
        # then the path will likely be ${{ github.workspace }}/ApiDemos/java
        cd ${{ github.workspace }}/ApiDemos/java
        ./gradlew assemble
        cp ./app/build/outputs/apk/debug/app-debug.apk ${{ github.workspace }}/ApiDemos-java-debug.apk

    - name: Build ApiDemos (Kotlin) APK
      run: |
        echo "Generating Kotlin (Kotlin) APKs"
        # Adjust the path below if 'ApiDemos' is directly in the root of the checked out repo
        # If your 'ApiDemos' directory is at the root of your repository,
        # then the path will likely be ${{ github.workspace }}/ApiDemos/kotlin
        cd ${{ github.workspace }}/ApiDemos/kotlin
        ./gradlew assemble
        cp ./app/build/outputs/apk/debug/app-debug.apk ${{ github.workspace }}/ApiDemos-kotlin-debug.apk

    # You can add more steps here, e.g., for uploading artifacts
    - name: Upload Java APK artifact
      uses: actions/upload-artifact@v4
      with:
        name: ApiDemos-java-debug-apk
        path: ${{ github.workspace }}/ApiDemos-java-debug.apk

    - name: Upload Kotlin APK artifact
      uses: actions/upload-artifact@v4
      with:
        name: ApiDemos-kotlin-debug-apk
        path: ${{ github.workspace }}/ApiDemos-kotlin-debug.apk
